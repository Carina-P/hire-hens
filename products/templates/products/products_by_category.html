{% extends "base_products.html" %}
{% load static %}
{% load cart_tools %}

{% block products_header %}
{% if this_category == 'all' %}
Product Management
{% else %}
{{ this_category }}
{% endif %}
{% endblock products_header %}

{% block products_content %}
{% if this_category == 'all' and request.user.is_superuser %}
<div class="text-center">
    <a class="btn btn-lg btn-black" href="{% url 'add_product' %}">Add product</a>
</div>
{% endif %}

<div class="row p-3">
    {% for product in products %}
    <div class="col-sm-6 col-md-6 col-lg-4 col-xl-3">
        {% include 'includes/card.html' %}
    </div>
    {% if forloop.counter|divisibleby:1 %}
    <div class="col-12 d-sm-none mb-2">
        <hr>
    </div>
    {% endif %}
    {% if forloop.counter|divisibleby:2 %}
    <div class="col-12 d-none d-sm-block d-md-block d-lg-none mb-2">
        <hr>
    </div>
    {% endif %}
    {% if forloop.counter|divisibleby:3 %}
    <div class="col-12 d-none d-lg-block d-xl-none mb-2">
        <hr>
    </div>
    {% endif %}
    {% if forloop.counter|divisibleby:4 %}
    <div class="col-12 d-none d-xl-block mb-2">
        <hr>
    </div>
    {% endif %}
    {% endfor %}
</div>
{% endblock products_content %}

{% block postloadjs %}
{{ block.super }}
<script type="text/javascript" src="{% static 'js/change_package_qty.js' %}"></script>

<script type="text/javascript">
    // Update quantity on click
    $('.update-package-link').click(function (e) {
        let form = $(this).prev('.update-package-form');
        form.submit();
    })

    // Remove item and reload on click
    $('.remove-package-item').click(function (e) {
        let csrfToken = "{{ csrf_token }}";
        let itemId = $(this).attr('id').split('remove-package_')[1];
        let url = `/products/remove_from_package/${itemId}/`;
        let data = {
            'csrfmiddlewaretoken': csrfToken
        };

        $.post(url, data)
            .done(function () {
                location.reload();
            });
    })
</script>

{% endblock %}